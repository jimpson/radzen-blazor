@page "/datafilter"

@using RadzenBlazorDemos.Data
@using RadzenBlazorDemos.Models.Northwind
@using Microsoft.EntityFrameworkCore

@inject NorthwindContext dbContext

<RadzenExample Name="DataFilter">
<div class="container">
    <div class="row py-5">
        <div class="col-12 p-3">
            <RadzenCard class="mx-auto d-flex" Style="margin-bottom: 10px;">
                <div class="d-flex">
                    <RadzenCheckBox @bind-Value="@auto" Name="auto" />
                    <RadzenLabel Text="Auto filter" Component="auto" Style="margin-left: 8px; margin-right: 32px; vertical-align: middle;" />
                </div>
                <div class="d-flex">
                    <RadzenButton Text="Filter" Click="@(args => dataFilter.Filter())" Disabled="@auto" />
                </div>
            </RadzenCard>
            <RadzenCard>
                <RadzenDataFilter @ref="dataFilter" Auto=auto Data="@orders" TItem="Order" ViewChanged=@(view => filteredOrders = view.ToList())>
                    <Columns>
                        <RadzenDataFilterColumn TItem="Order" Property="OrderID" Title="ID" />
                        <RadzenDataFilterColumn TItem="Order" Property="Employee.LastName" Title="Employee Last Name" />
                        <RadzenDataFilterColumn TItem="Order" Property="OrderDate" Title="Order Date" />
                    </Columns>
                </RadzenDataFilter>
            </RadzenCard>
        </div>
        <div class="col">
            <RadzenCard>
                <RadzenDataGrid @ref="ordersGrid" AllowPaging="true" AllowSorting="true" Data="@(filteredOrders ?? orders)" TItem="Order"
                    ColumnWidth="200px" PageSize="20" Style="height: 500px">
                    <Columns>
                        <RadzenDataGridColumn Width="50px" TItem="Order" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Frozen=true>
                            <Template>
                                @(orders.IndexOf(context) + 1)
                            </Template>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Width="200px" TItem="Order" Property="OrderID" Title="Order ID">
                            <FooterTemplate>
                                Displayed orders: <b>@ordersGrid.View.Count()</b> of <b>@orders.Count()</b>
                            </FooterTemplate>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Width="200px" TItem="Order" Property="Customer.CompanyName" Title="Customer" />
                        <RadzenDataGridColumn TItem="Order" Property="Employee.LastName" Title="Employee">
                            <Template Context="order">
                                @order.Employee?.FirstName @order.Employee?.LastName
                            </Template>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn TItem="Order" Property="OrderDate" Title="Order Date" FormatString="{0:d}">
                            <FooterTemplate>
                                Last order date: <b>@String.Format("{0:d}", orders.OrderByDescending(o => o.OrderDate).Last().OrderDate)</b>
                            </FooterTemplate>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn TItem="Order" Property="Freight" Title="Freight">
                            <Template Context="order">
                                @String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", order.Freight)
                            </Template>
                            <FooterTemplate>
                                Total amount: <b>@String.Format(new System.Globalization.CultureInfo("en-US"), "{0:C}", orders.Sum(o => o.Freight))</b>
                            </FooterTemplate>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn TItem="Order" Property="ShipName" Title="Ship Name" />
                    </Columns>
                </RadzenDataGrid>
            </RadzenCard>
        </div>
    </div>
</div>
</RadzenExample>

@code {
    bool auto = true;
    RadzenDataFilter<Order> dataFilter;

    IList<Order> filteredOrders;
    IList<Order> orders;
    RadzenDataGrid<Order> ordersGrid;

    protected override void OnInitialized()
    {
        orders = dbContext.Orders.Include("Customer").Include("Employee").ToList();
    }
}